{% extends 'bootstrap/base.html' %}

<header>

</header>

{% block navbar %}
<h1>HOC<span class="badge badge-secondary">BETA</span></h1>
{% endblock %}


{% block content %}
<form action="" method="post" enctype="multipart/form-data">
<div style="display: flex;margin: 10px;flex-direction: column;justify-content: center">
      <div class="form-group">
          <label for="label-file">label file</label>
          <input type="file" class="form-control-file" accept=".npy" id="label-file" name="label-file"/>

      </div>
    <div class="form-group">
        <label for="feature-file">feature file</label>
      <input type="file" class="form-control-file" accept=".npy" id="feature-file" name="feature-file"/>

    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary my-1">Submit</button>
    </div>

</div>
</form>
    <div class="progress" style="display: none;">
    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0;">
        0%
    </div>

    </div>
    <pre id="log" style="display: none;overflow: auto;overflow-y: scroll"></pre>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script type="text/javascript">
    $('form').on('submit',function (event) {
        let flag = false
        event.preventDefault()
        $('.progress').css('display', 'block')
        $('#log').css('display','block')
        let formData = new FormData(this);
        console.log("submitted")
        console.log(this)
        console.log(formData.forEach(x=>console.log(x)))
         $.ajax({
            xhr: function () {
                var xhr = new XMLHttpRequest();
                xhr.upload.addEventListener('progress', function (e) {
                    if (e.lengthComputable) {
                        var percent = Math.round(e.loaded * 100 / e.total);
                        $('.progress-bar').attr('aria-valuenow', percent).css('width', percent + '%').text(percent + '%');
                    }
                });
                return xhr;
            },
            type: 'POST',
            url: '/',
            cache: false,
            data: formData,
            processData: false,
            contentType: false
        }).done(function (res) {
            console.log(res)
             flag=true
            document.write(res)
        }).fail(function (res) {
            flag=true
            alert('上传失败!')

        });
        let interval = setInterval(function () {
            $.get("/getlog",function (result) {
                if (flag){
                    clearInterval(interval)
                }
                //console.log(result)
                $('#log').html(result)
            })
        },2000)
    });
</script>
{% endblock %}


{% extends 'bootstrap/base.html' %}

<header>

</header>

{% block navbar %}
<h1>HOC<span class="badge badge-secondary">DEMO</span></h1>
{% endblock %}


{% block content %}
<form action="" method="post" enctype="multipart/form-data">

    <div style="display: flex;margin: 10px;flex-direction: column;justify-content: center">
          <div class="form-group">
              <label for="label-file">label file</label>
              <input type="file" class="form-control-file" accept=".npy" id="label-file" name="label-file"/>

          </div>

        <div class="form-group">

            <label for="feature-file">feature file</label>
          <input type="file" class="form-control-file" accept=".npy" id="feature-file" name="feature-file"/>

        </div>
        <div class="form-group ">
            <label class="form-check-label" for="clip">Use CLIP</label>
            <input type="checkbox" id="clip" name="use_clip">
            <label style="margin-left: 10px" class="form-check-label" for="step">Step</label>
            <input style="width: 60px" type="number" id="step" name="step">
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Submit</button>
        </div>

    </div>
</form>
    <div class="progress" style="display: none;">
    <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0;">
        0%
    </div>

    </div>
    <pre id="log" style="display: none;overflow:scroll;height: 200px"></pre>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script type="text/javascript">
    $('form').on('submit',function (event) {
        let flag = false
        event.preventDefault()
        $('.progress').css('display', 'block')
        $('#log').css('display','block')
        let formData = new FormData(this);
        console.log("submitted")
        console.log(this)
        console.log(formData.forEach(x=>console.log(x)))
         $.ajax({
            xhr: function () {
                var xhr = new XMLHttpRequest();
                xhr.upload.addEventListener('progress', function (e) {
                    if (e.lengthComputable) {
                        var percent = Math.round(e.loaded * 100 / e.total);
                        $('.progress-bar').attr('aria-valuenow', percent).css('width', percent + '%').text(percent + '%');
                    }
                });
                return xhr;
            },
            type: 'POST',
            url: '/',
            cache: false,
            data: formData,
            processData: false,
            contentType: false
        }).done(function (res) {
            console.log(res)
             flag=true
            document.write(res)
        }).fail(function (res) {
            flag=true
            alert('Uploading Failed!')

        });
        let interval = setInterval(function () {
            $.get("/getlog",function (result) {
                if (flag){
                    clearInterval(interval)
                }
                //console.log(result)
                $('#log').html(result)
            })
        },2000)
    });
</script>

<div style="margin-left: 10px">
    <!-- <p>ReadME</p> -->
    <p>Demo for ICML2021 [1]: Clusterability as an Alternative to Anchor Points When Learning with Noisy Labels</p>
    <p>Designed by Zihao Dong @ UCSC</p>
    <p><strong>Label file:</strong> *.npy. [Numpy array: (DataSize, )]</p>
    <p><strong>Feature file:</strong> *.npy. [Numpy array: (DataSize,  Shape of an Instance)] </p>
    <p><strong>Use CLIP:</strong> Use CLIP [2] to extract representations or use raw feature</p>
    <p><strong>Step:</strong> Number of steps/iterations to solve consensus equations with SGD</p>


    <p><strong>Example:</strong></p>
    <p>10,000 instances of CIFAR-10: feature.npy &rarr; (10000,32,32,3); label.npy &rarr; (10000,)</p>
    <p>Use CLIP. Step = 500.</p>

    <p>Current demo is only tested with CIFAR-10.</p>

    <p><strong>Reference:</strong></p>
    <p>
    [1] Zhu, Z., Song, Y. and Liu, Y., 2021. Clusterability as an alternative to anchor points when learning with noisy labels.
    </p>
    <p>
    [2] Radford, A., Kim, J.W., Hallacy, C., Ramesh, A., Goh, G., Agarwal, S., Sastry, G., Askell, A., Mishkin, P., Clark, J. and Krueger, G., 2021. Learning transferable visual models from natural language supervision.
    </p>
    <!-- <p>Please do not </p> -->
    <!-- <p>You can use the mark tag to <mark>highlight</mark> text.</p> -->
    <!-- <p><del>This line of text is meant to be treated as deleted text.</del></p>
    <p><s>This line of text is meant to be treated as no longer accurate.</s></p>
    <p><ins>This line of text is meant to be treated as an addition to the document.</ins></p>
    <p><u>This line of text will render as underlined.</u></p>
    <p><small>This line of text is meant to be treated as fine print.</small></p>
    <p><strong>This line rendered as bold text.</strong></p>
    <p><em>This line rendered as italicized text.</em></p> -->
</div>

{% endblock %}

